# Telegram-бот: приветствие, клавиатура и сбор заявок

---

## Цель проекта

<span style="color: #0366d6">**Цель проекта**</span> — предоставить компании телеграм-бота, который:

- приветствует пользователей и выдаёт информацию о компании и кейсах;
- собирает заявки от потенциальных клиентов (с указанием телефона);
- ведёт статистику взаимодействий и 1-го числа каждого месяца сохраняет сводку за предыдущий месяц в файл.

Бот рассчитан на использование в Telegram как основной канал приёма заявок и информирования.

---

## Стек и технологии

| Категория | Технология |
|-----------|------------|
| <span style="color: #22863a">Язык</span> | Python 3.9+ |
| <span style="color: #22863a">Telegram API</span> | pyTelegramBotAPI 4.30.0 |
| <span style="color: #22863a">Конфигурация</span> | python-dotenv 1.0.1 |
| <span style="color: #22863a">База данных</span> | SQLite (файл `bot_stats.db`) |
| <span style="color: #22863a">Ответы на вопросы</span> | YandexGPT (опционально, Yandex Cloud LLM API) |
| <span style="color: #22863a">Контейнеризация</span> | Docker, Docker Compose |

Зависимости перечислены в `requirements.txt`.

---

## Установка

1. **Клонируйте репозиторий** (или скачайте архив по ссылкам ниже).

2. **Перейдите в каталог проекта:**

```bash
cd Bot
```

3. **Создайте виртуальное окружение** (рекомендуется):

```bash
python -m venv .venv
.venv\Scripts\activate
```

4. **Установите зависимости:**

```bash
pip install -r requirements.txt
```

5. **Создайте бота в Telegram** через [@BotFather](https://t.me/BotFather) и получите токен.

6. **Создайте файл `.env`** в корне проекта:

```env
TELEGRAM_BOT_TOKEN=ваш_токен_от_BotFather
ADMIN_ID=ваш_telegram_id_числом
YANDEX_FOLDER_ID=идентификатор_каталога_Yandex_Cloud
YANDEX_API_KEY=ваш_API_ключ_Yandex_Cloud
```

- <span style="color: #22863a">TELEGRAM_BOT_TOKEN</span> — токен от @BotFather.
- <span style="color: #22863a">ADMIN_ID</span> — числовой Telegram ID пользователя-администратора (ему доступна кнопка «Статистика» и уведомления о заявках). Поддерживается также ключ <span style="color: #0366d6">ADMIN_ID_SECRET</span>.
- <span style="color: #22863a">YANDEX_FOLDER_ID</span> и <span style="color: #22863a">YANDEX_API_KEY</span> — данные Yandex Cloud (необязательно). Если заданы, бот отвечает на произвольные вопросы через <span style="color: #0366d6">YandexGPT</span>. Каталог (folder) и API-ключ создают в [консоли Yandex Cloud](https://console.cloud.yandex.ru); для ключа нужна роль с доступом к YandexGPT (например, `ai.languageModels.user`).

Файл `.env` не должен попадать в репозиторий (указан в `.gitignore`).

---

## Запуск

### Локальный запуск

```bash
python bot.py
```

В консоли появится сообщение о том, что бот запущен. Остановка — <span style="color: #b22222">Ctrl+C</span>.

Бот обрабатывает только те сообщения, которые пришли **после** его запуска: запросы, отправленные пока бот был выключен, игнорируются.

### Запуск в Docker

Соберите образ и запустите контейнер:

```bash
docker-compose up -d --build
```

Просмотр логов:

```bash
docker-compose logs -f bot
```

Остановка:

```bash
docker-compose down
```

Переменные окружения берутся из файла `.env` (файл должен существовать на хосте).

---

## Пример работы

1. Пользователь отправляет боту команду <span style="color: #0366d6">/start</span>.
2. Бот приветствует и показывает клавиатуру с кнопками: **О нас**, **Кейсы** (у администратора также **Статистика**).
3. **О нас** — бот отправляет текст о компании.
4. **Кейсы** — показываются кейсы и предлагается оставить заявку; бот запрашивает телефон (кнопка «Отправить контакт» или ввод вручную). После ввода номера пользователь получает благодарность, заявка сохраняется в БД, администратору приходит уведомление с контактом и просьбой связаться.
5. **Статистика** (только для администратора) — в чат выводится сводка за последние 30 дней: число пользователей, нажатия «О нас» и «Кейсы», всего сообщений.
6. Команда <span style="color: #0366d6">/stats</span> — общая статистика за всё время (для любого пользователя).
7. **Произвольный вопрос** — если в `.env` заданы <span style="color: #0366d6">YANDEX_FOLDER_ID</span> и <span style="color: #0366d6">YANDEX_API_KEY</span>, на любой текст, не совпадающий с кнопками и не похожий на телефон, бот отвечает с помощью <span style="color: #0366d6">YandexGPT</span>. Без них бот предложит выбрать кнопку «О нас» или «Кейсы».
8. 1-го числа каждого месяца при запуске бота статистика за предыдущий месяц дописывается в файл <span style="color: #22863a">statistic.txt</span>.

Администратор задаётся в файле <span style="color: #b22222">.env</span> переменной <span style="color: #b22222">ADMIN_ID</span> (числовой Telegram ID).

---

## Ссылки для скачивания

- **Исходный код (Git):** клонирование репозитория:
  ```bash
  git clone <URL_репозитория>
  ```
- **Архив:** при использовании GitHub/GitLab — кнопка **Code** → **Download ZIP** на странице репозитория.

Замените <span style="color: #0366d6">URL_репозитория</span> на актуальную ссылку вашего репозитория.

---

## Разработка

Проект выполнен с использованием **Cursor** ([cursor.com](https://cursor.com)) — AI-инструмента для написания и доработки кода.

---

## Структура проекта

```
Bot/
├── bot.py              # Основной код бота
├── requirements.txt    # Зависимости Python
├── .env                # TELEGRAM_BOT_TOKEN, ADMIN_ID, при необходимости YANDEX_FOLDER_ID и YANDEX_API_KEY
├── .gitignore
├── .dockerignore
├── Dockerfile
├── docker-compose.yml
├── README.md
├── bot_stats.db        # SQLite (создаётся при первом запуске)
└── statistic.txt       # Месячная статистика (создаётся при сохранении)
```

## База данных

Бот создаёт SQLite-файл `bot_stats.db` с таблицами:

- **users** — пользователи, счётчики нажатий и сообщений
- **interactions** — история взаимодействий для помесячной статистики
- **applications** — заявки с телефонами
- **monthly_stats_saves** — отметки о сохранении статистики по месяцам

## Примечания

- Режим работы бота — long polling (`infinity_polling`). При старте включается пропуск накопившихся обновлений (<span style="color: #22863a">skip_pending=True</span>): бот не отвечает на сообщения, отправленные до его запуска.
- Время в БД хранится в UTC (ISO 8601).
- ID администратора хранится в <span style="color: #b22222">.env</span> (ключ <span style="color: #b22222">ADMIN_ID</span> или <span style="color: #b22222">ADMIN_ID_SECRET</span>). Для смены администратора измените значение в `.env`.
